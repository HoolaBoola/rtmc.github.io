<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Guide for teachers</title>
  <meta name="description" content="This site contains information of how to use the Test my code -addin for RStudio.">

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="http://localhost:4000/guide_teachers/">
  <link rel="alternate" type="application/rss+xml" title="RTMC" href="/feed.xml">
  
  
</head>


  <body>

    <header class="site-header" role="banner">

  <div class="wrapper">
    
    
    <a class="site-title" href="/">RTMC</a>
  
    
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          
            
            
            <a class="page-link" href="/about/">About</a>
            
          
            
            
            <a class="page-link" href="/guide_teachers/">Guide for teachers</a>
            
          
            
            
            <a class="page-link" href="/guide_students/">Guide for students</a>
            
          
            
            
          
            
            
            <a class="page-link" href="/install_addin/">Installing the addin</a>
            
          
            
            
            <a class="page-link" href="/ohjeet_opiskelija/">Ohjeet opiskelijalle</a>
            
          
            
            
          
            
            
          
        </div>
      </nav>
    
  </div>
</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Guide for teachers</h1>
  </header>

  <div class="post-content">
    <h2 id="create-tmc-account">Create tmc account</h2>

<p>Follow the instructions in <a href="http://testmycode-usermanual.github.io/usermanual/teachers.html">this guide</a> to create a test my code account which allows you to link the exercises to the course.</p>

<h2 id="creating-a-course-repository">Creating a course repository</h2>

<p>To create a tmc-course for R, you will need to create a git repository. This will contain exercise folders that serve as the basis for students’ code for the exercises. Also in this repository you can write the tests for each exercise to check if students’ code runs correctly.</p>

<p>There are couple of ways to create a repository. If you know your way around git, feel free to do it however you prefer to.</p>

<p>One easy way to create a git repository is using GitHub, which is a repository hosting service.</p>

<p>First, sign up / log in to <a href="https://github.com">GitHub</a>.</p>

<p>After logging on, you’ll see the GitHub front page and (somewhere there) a big green button saying <em>new repository</em>. Click it.</p>

<p><img src="../../resources/github_create_repo.png" alt="New repository" /></p>

<p>Fill in the needed fields. The repository needs a name at least.</p>

<p><img src="../../resources/creating_repo_2.png" alt="New repository" /></p>

<p>And here it is, an empty repository. Now you can begin adding exerises.</p>

<p><img src="../../resources/empty_repository.png" alt="New repository" /></p>

<h2 id="structure-of-the-repository">Structure of the repository</h2>

<p>Your repository should be structured something like this:</p>

<ul>
  <li><em>ROOT</em>
    <ul>
      <li><code class="highlighter-rouge">Week1</code>
        <ul>
          <li><code class="highlighter-rouge">01_some_exercise</code>
            <ul>
              <li><code class="highlighter-rouge">R</code>
                <ul>
                  <li><code class="highlighter-rouge">arithmetic.R</code></li>
                </ul>
              </li>
              <li><code class="highlighter-rouge">src</code>
                <ul>
                  <li><code class="highlighter-rouge">empty.txt</code></li>
                </ul>
              </li>
              <li><code class="highlighter-rouge">tests</code>
                <ul>
                  <li><code class="highlighter-rouge">testthat</code>
                    <ul>
                      <li><code class="highlighter-rouge">testArithmetic.R</code></li>
                      <li><code class="highlighter-rouge">testArithmeticHidden.R</code></li>
                    </ul>
                  </li>
                </ul>
              </li>
            </ul>
          </li>
          <li><code class="highlighter-rouge">02_some_other-exercise</code>
            <ul>
              <li><code class="highlighter-rouge">R</code>
                <ul>
                  <li><code class="highlighter-rouge">matrices.R</code></li>
                </ul>
              </li>
              <li><code class="highlighter-rouge">src</code>
                <ul>
                  <li><code class="highlighter-rouge">empty.txt</code></li>
                </ul>
              </li>
              <li><code class="highlighter-rouge">tests</code>
                <ul>
                  <li><code class="highlighter-rouge">testthat</code>
                    <ul>
                      <li><code class="highlighter-rouge">testMatrices.R</code></li>
                    </ul>
                  </li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>
      </li>
      <li><code class="highlighter-rouge">Week2</code></li>
    </ul>
  </li>
</ul>

<p>The root of the repository has directories for each exercise as subdirectories. In each of these directories, you should include three separate directories:</p>

<ol>
  <li><code class="highlighter-rouge">R</code>:
    <ul>
      <li>This is where the code that the students can edit goes. You can have the student write the whole file or simply parts of the file.</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">src</code>:
    <ul>
      <li>This is a dummy directory that exists for a technical reason.</li>
      <li>You should include an empty text file “empty.txt” in this folder</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">test</code>:
    <ul>
      <li><code class="highlighter-rouge">test</code>-folder has a subfolder, <code class="highlighter-rouge">testthat</code>, where the test-files go. In these files, you can include test that check whether the student has written correct code in the <code class="highlighter-rouge">R</code>-folder. <em>If the student file is called somename.R, the test file should be named testSomename.R</em>. That is, you should name the corresponding test file by prepending “test” to the name of the student file and capitalizing the first letter of the student file.</li>
      <li>If you want to create a hiddent test file that the students can’t see, append “Hidden” to the end of the file name. Say that you want to create a hidden test file for the student file <code class="highlighter-rouge">matrices.R</code>. This should be named <code class="highlighter-rouge">testMatricesHidden.R</code>.</li>
    </ul>
  </li>
</ol>

<h2 id="adding-your-repository-to-tmc-servers">Adding your repository to TMC servers</h2>

<p>After creating your repository with the skeleton presented above, you can add
it to TMC servers. To this end, follow the steps in item <a href="http://testmycode-usermanual.github.io/usermanual/customcourse.html#creating_a_course">1.2 in this material</a></p>

<h2 id="writing-tests">Writing tests</h2>

<p>The tests should be written in the folder <code class="highlighter-rouge">tests/testthat</code>. Suppose you  have a <em>student source file</em> <code class="highlighter-rouge">vectors.R</code> where the student is instructed to create a vector containing all integers from 8 to 800 by interval of 8 (that is, the integers 8, 16, 24, …, 792, 800).</p>

<p>To test this, create a test file <code class="highlighter-rouge">tests/testthat/testVectors.R</code>. Below is an example of how this file could look like:</p>

<pre><code class="language-{r}">
library('testthat')

points_for_all_tests("r7")

test("7b", "r7.1", {
  expected_v1 &lt;- c(8, 16, 24, 32, 40, 48, 56, 64, 72, 80, 88, 96, 104, 112, 120, 128,
                   136, 144, 152, 160, 168, 176, 184, 192, 200, 208, 216, 224, 232,
                   240, 248, 256, 264, 272, 280, 288, 296, 304, 312, 320, 328, 336,
                   344, 352, 360, 368, 376, 384, 392, 400, 408, 416, 424, 432, 440,
                   448, 456, 464, 472, 480, 488, 496, 504, 512, 520, 528, 536, 544,
                   552, 560, 568, 576, 584, 592, 600, 608, 616, 624, 632, 640, 648,
                   656, 664, 672, 680, 688, 696, 704, 712, 720, 728, 736, 744, 752,
                   760, 768, 776, 784, 792, 800)

  expect_equal(v1, expected_v1)
})

test("7c", c("r7.2"), {
  expect_equal(pituus, 24)
})
</code></pre>

<p>There are a few important things to note in this test file:</p>

<ul>
  <li>include the line <code class="highlighter-rouge">library('testthat')</code> at the beginning of your test file.</li>
  <li>Determine the points that the student from solving the exercise problems using the function <code class="highlighter-rouge">points_for_all_tests("r1")</code>. It doesn’t really matter what your points are called, as long as they are unique. For example, you could use names <em>a1, a2, a3,…</em> or <em>ex1, ex2, ex3…</em> for the points.</li>
  <li>You can tests students code with the <code class="highlighter-rouge">test</code>-function. Test function works almost exactly like <code class="highlighter-rouge">test_that</code>-function from the <a href="https://journal.r-project.org/archive/2011-1/RJournal_2011-1_Wickham.pdf">testthat-library</a>, but it allows you to pass the points corresponding to the test as parameter. For example, in the following snippet, the corresponding points are given as a parameter <code class="highlighter-rouge">c("r7.2")</code>.
    <pre><code class="language-{r}">test("7c", c("r7.2"), {
  expect_equal(pituus, 24)
})
</code></pre>
  </li>
  <li><code class="highlighter-rouge">expect_equal</code>-function allows you to check whether two variables have the same value. From <a href="https://journal.r-project.org/archive/2011-1/RJournal_2011-1_Wickham.pdf">testthat-documentation</a> you can read more about these <code class="highlighter-rouge">expect_</code>-functions. If all <code class="highlighter-rouge">expect_</code>-functions inside a <code class="highlighter-rouge">test</code>-function passes, the the student is given the point given as a parameter in the function call.</li>
</ul>

<h3 id="hidden-tests">Hidden tests</h3>

<p>As mentioned above, if you want to have hidden tests for the exercise, include the string “Hidden” anywhere in the name of the test file. So if you want to test the file <code class="highlighter-rouge">matrices.R</code>, you should have a test called <code class="highlighter-rouge">testMatricesHidden.R</code> in the folder <code class="highlighter-rouge">tests/testthat</code>.</p>

<h3 id="mocking-functions">Mocking functions</h3>

<p>Testing R might be tricky in some cases where the student is instructed to use functions like <code class="highlighter-rouge">plot</code>, <code class="highlighter-rouge">paste</code>, <code class="highlighter-rouge">rnorm</code> that do not create any testable object or create objects that are inherently random and as such difficult to test.</p>

<p>Luckily, with RTMC you can circumvent these problems by creating mock functions in the test environment. When the student uses, say, <code class="highlighter-rouge">plot</code>-function, the function that is called is the standard <code class="highlighter-rouge">plot</code>-function for R. However, when the tests are run, these functions can be overriden and their parameters can be collected, allowing you to test if the student has used the correct parameter values when calling the function.</p>

<p>To do this, you should include a file called <code class="highlighter-rouge">mock.R</code> in the folder <code class="highlighter-rouge">tests/testthat</code>. This file could look like this:</p>

<pre><code class="language-{r}">#In this file, the teacher can override R functions so that she/he can
#test whether the student has used some function (and maybe with the correct
#arguments)

used_plot_args &lt;- list()
used_paste_args &lt;- list()

plot &lt;- function(x, y, ...) {
    params &lt;- list(x = x, y = y, ...)

    # Assigning to environment before this function call:
    env_parent &lt;- parent.frame()
    env_parent$used_plot_args[[length(used_plot_args) + 1]] &lt;- params

    graphics::plot(x = x,y = y, ...)

    if (file.exists("Rplots.pdf")) {
      file.remove("Rplots.pdf")
    }
}

used_paste_args &lt;- list()

paste0 &lt;- function(...) {
    params &lt;- list(...)

    # Assigning to environment before this function call:
    env_parent &lt;- parent.frame()
    env_parent$used_paste_args[[length(used_paste_args) + 1]] &lt;- params

    base::paste0(...)
}
</code></pre>

<p>This file is sourced before any tests are run, so you can override some of the functions that the student might use. For example, in the passage</p>

<pre><code class="language-{r}">used_plot_args &lt;- list()

plot &lt;- function(x, y, ...) {
    params &lt;- list(x = x, y = y, ...)

    # Assigning to environment before this function call:
    env_parent &lt;- parent.frame()
    env_parent$used_plot_args[[length(used_plot_args) + 1]] &lt;- params

    graphics::plot(x = x,y = y, ...)

    if (file.exists("Rplots.pdf")) {
      file.remove("Rplots.pdf")
    }
}
</code></pre>

<p>we first create a list of function call parameters <code class="highlighter-rouge">used_plot_args</code>. After that, we override the plot function, collect the arguments used to construct the plot, and finally call the <code class="highlighter-rouge">plot</code>-function.</p>

<p>Now you can test if the student has use the correct arguments when calling <code class="highlighter-rouge">plot</code>. Your test file might have lines like these:</p>

<pre><code class="language-{r}">expect_equal(used_plot_args[[1]]$x, seq(0,10, by = .1))
expect_equal(used_plot_args[[1]]$y, sin(seq(0,10,by=.1)))
expect_equal(used_plot_args[[1]]$main, "sin x")
</code></pre>

<p>These expectations pass if the student has called plot with <code class="highlighter-rouge">plot(x = seq(0, 10, by = .1), y = sin(seq(0, 10, by = .1), main = "sin x"))</code>.</p>

<p>You can mock any function following this template.</p>

  </div>

</article>

      </div>
    </main>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">RTMC</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>
            
              RTMC
            
            </li>
            
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/rtmc"><span class="icon icon--github"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">rtmc</span></a>

          </li>
          

          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>This site contains information of how to use the Test my code -addin for RStudio.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
